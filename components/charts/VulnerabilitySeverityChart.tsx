'use client';

import React from 'react';
import {
  Radar,
  RadarChart,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  ResponsiveContainer,
  Tooltip,
  Legend,
} from 'recharts';
import { cn } from '@/lib/utils';

interface VulnerabilitySeverityChartProps {
  data?: {
    category: string;
    critical: number;
    high: number;
    medium: number;
    low: number;
  }[];
  height?: number;
  className?: string;
}

const defaultData = [
  { category: 'Injection', critical: 4, high: 8, medium: 12, low: 5 },
  { category: 'Auth', critical: 2, high: 6, medium: 8, low: 10 },
  { category: 'XSS', critical: 1, high: 4, medium: 15, low: 8 },
  { category: 'Config', critical: 0, high: 3, medium: 7, low: 12 },
  { category: 'Access', critical: 3, high: 5, medium: 6, low: 4 },
  { category: 'Crypto', critical: 1, high: 2, medium: 4, low: 3 },
];

export const VulnerabilitySeverityChart: React.FC<VulnerabilitySeverityChartProps> = ({
  data = defaultData,
  height = 400,
  className,
}) => {
  const [selectedSeverity, setSelectedSeverity] = React.useState<string | null>(null);

  // Transform data for radar chart
  const radarData = data.map(item => ({
    category: item.category,
    Critical: item.critical,
    High: item.high,
    Medium: item.medium,
    Low: item.low,
  }));

  const severityColors = {
    Critical: '#dc2626',
    High: '#ea580c',
    Medium: '#f59e0b',
    Low: '#3b82f6',
  };

  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-white p-3 rounded-lg shadow-lg border border-gray-200">
          <p className="font-semibold text-gray-900 mb-2">{label}</p>
          {payload.map((entry: any, index: number) => (
            <div key={index} className="flex items-center justify-between text-sm">
              <span className="flex items-center">
                <span
                  className="w-3 h-3 rounded-full mr-2"
                  style={{ backgroundColor: entry.color }}
                />
                {entry.name}
              </span>
              <span className="ml-4 font-medium">{entry.value}</span>
            </div>
          ))}
        </div>
      );
    }
    return null;
  };

  const handleLegendClick = (entry: any) => {
    setSelectedSeverity(
      selectedSeverity === entry.value ? null : entry.value
    );
  };

  return (
    <div className={cn('w-full', className)}>
      <ResponsiveContainer width="100%" height={height}>
        <RadarChart data={radarData}>
          <PolarGrid
            strokeWidth={1}
            stroke="#e5e7eb"
            radialLines={true}
          />
          <PolarAngleAxis
            dataKey="category"
            tick={{ fontSize: 12 }}
            className="text-gray-600"
          />
          <PolarRadiusAxis
            angle={90}
            domain={[0, 'auto']}
            tick={{ fontSize: 10 }}
            className="text-gray-500"
          />
          {Object.entries(severityColors).map(([severity, color]) => (
            <Radar
              key={severity}
              name={severity}
              dataKey={severity}
              stroke={color}
              fill={color}
              fillOpacity={
                selectedSeverity === null || selectedSeverity === severity
                  ? 0.3
                  : 0.1
              }
              strokeWidth={
                selectedSeverity === severity ? 2 : 1
              }
            />
          ))}
          <Tooltip content={<CustomTooltip />} />
          <Legend
            wrapperStyle={{ paddingTop: '20px' }}
            onClick={handleLegendClick}
            onMouseEnter={handleLegendClick}
            onMouseLeave={() => setSelectedSeverity(null)}
          />
        </RadarChart>
      </ResponsiveContainer>
      
      {/* Summary stats */}
      <div className="grid grid-cols-4 gap-4 mt-6">
        {Object.entries(severityColors).map(([severity, color]) => {
          const total = radarData.reduce(
            (sum, item) => sum + (item[severity as keyof typeof item] as number),
            0
          );
          return (
            <div
              key={severity}
              className="text-center p-3 bg-gray-50 rounded-lg"
            >
              <div
                className="text-2xl font-bold mb-1"
                style={{ color }}
              >
                {total}
              </div>
              <div className="text-xs text-gray-600 uppercase tracking-wider">
                {severity}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};
